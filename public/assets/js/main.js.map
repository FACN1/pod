{"version":3,"sources":["main.js"],"names":["makeRequest","method","url","callback","payload","header","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseText","Error","open","setRequestHeader","send","cCardLink","document","querySelector","geo","navigator","geolocation","displayLocation","position","latitude","coords","longitude","P","A","shopCoordinates","location","NE","B","NW","C","SW","D","SE","X","Y","sort","a","b","style","display","getLocation","div","getElementById","watchPosition","innerHTML","alert","window","onload","addEventListener","click","cardCamera","token","cardEvent","err","res","console","error","data","JSON","parse","cartErr","cartRes","itemCamera","itemEvent","itemErr","itemRes","itemData","log","target","files","history","pushState"],"mappings":"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","file":"main.js","sourcesContent":["const makeRequest = (method, url, callback, payload, header) => {\n  const xhr = new XMLHttpRequest();\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        callback(null, xhr.responseText);\n      } else {\n        callback(new Error('Status Code: ', xhr.status));\n      }\n    }\n  };\n\n  xhr.open(method, url);\n  if (header) xhr.setRequestHeader(header[0], header[1]);\n  if (payload) return xhr.send(payload);\n  return xhr.send(payload);\n};\n\n\nconst cCardLink = document.querySelector('.visa-img');\n\n// const clickLinkListener = (element) => {\n//   element.addEventListener('click', (event) => {\n//     event.preventDefault();\n//\n//     const originalUrl = cCardLink.href;\n//\n//     console.log(event);\n//     makeRequest('GET', cCardLink.href, (err, res) => {\n//       if (err) {\n//         console.error(err);\n//         return;\n//       }\n//       document.getElementById('outerContainer').innerHTML = res;\n//       window.history.pushState(null, null, originalUrl.split('?ajax=true')[0]);\n//\n//       clickLinkListener(cCardLink);\n//     });\n//   });\n// };\n//\n// clickLinkListener(cCardLink);\n\nconst geo = navigator.geolocation;\n\n// If geolocation supported run:\nconst displayLocation = (position) => {\n  // Store position\n  const latitude = position.coords.latitude;\n  const longitude = position.coords.longitude;\n  // Set point to validate\n  const P = [latitude, longitude];\n  // Shop Coordinates\n  const A = shopCoordinates.location.NE;\n  const B = shopCoordinates.location.NW;\n  const C = shopCoordinates.location.SW;\n  const D = shopCoordinates.location.SE;\n  // Set Array of latitude, Array of longitude\n  let X = [A[0], B[0], C[0], D[0]];\n  let Y = [A[1], B[1], C[1], D[1]];\n  // Sort\n  X = X.sort((a, b) => a - b);\n  Y = Y.sort((a, b) => a - b);\n  // Check if coordinates are within shop geofence\n  if (P[0] >= X[0] && P[0] <= X[3]) {\n    if (P[1] >= Y[0] && P[1] <= Y[3]) {\n      // Show link\n      cCardLink.style.display = 'flex';\n      return true;\n    }\n  }\n  // Hide link\n  cCardLink.style.display = 'none';\n  return false;\n};\n\n// Check for geo support\nconst getLocation = () => {\n  const div = document.getElementById('location');\n  if (geo) {\n    geo.watchPosition((position) => {\n      if (displayLocation(position)) {\n        div.innerHTML = 'Welcome to Khan El Shopa';\n      } else {\n        div.innerHTML = '';\n      }\n    });\n  } else {\n    alert('Geolocation API not supported');\n  }\n};\n\nwindow.onload = getLocation;\n\ndocument.querySelector('.visa-img').addEventListener('click', (/* event */) => {\n  document.getElementById('cardCamera').click();\n});\n\nconst cardCamera = document.getElementById('cardCamera');\n// const frame = document.getElementById('frame');\nlet token = '';\n\n\ncardCamera.addEventListener('change', (cardEvent) => {\n  makeRequest('POST', '/card', (err, res) => {\n    if (err) return console.error(err);\n\n    const data = JSON.parse(res);\n    if (!token) token = data.token;\n\n    return makeRequest('GET', '/cart?ajax=true', (cartErr, cartRes) => {\n      if (cartErr) return console.error(cartErr);\n\n      document.getElementById('outerContainer').innerHTML = cartRes;\n\n      const itemCamera = document.getElementById('itemCamera');\n\n      itemCamera.addEventListener('change', (itemEvent) => {\n        makeRequest('POST', '/add-item', (itemErr, itemRes) => {\n          if (itemErr) return console.error(itemErr);\n\n          const itemData = JSON.parse(itemRes);\n\n          return console.log({ itemData });\n        }, itemEvent.target.files[0], ['Authorization', token]);\n      });\n\n      return window.history.pushState(null, null, '/cart');\n    }, null, ['Authorization', token]);\n  }, cardEvent.target.files[0]);\n});\n"]}
